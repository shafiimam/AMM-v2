<div class="timeline-section-container section-spacing container">
  <div class="timeline-header">
    <div class="timeline-heading-container">
      <h1 class="timeline-heading">{{ section.settings.title }}</h1>
    </div>
    <div class="timeline-nav-container">
      <timeline-nav-items>
        {% for block in section.blocks %}
          {% if forloop.first %}
            <div class="nav-highlight">
              <button
                class="timeline-nav-button timeline-nav--selected"
                data-tab-label="{{ block.settings.label }}"
              >
                <span>{{ block.settings.label }}</span>
              </button>
            </div>
          {% else %}
            <button
              class="timeline-nav-button"
              data-tab-label="{{ block.settings.label }}"
            >
              <span>{{ block.settings.label }}</span>
            </button>
          {% endif %}
        {% endfor %}
      </timeline-nav-items>
    </div>
  </div>
  <timeline-block-items class="timeline-block-items-container">
    {% for block in section.blocks %}
      {% capture image_content %}
         <div class="block-image-container">
            {%- if block.settings.image -%}
               <picture>
                 {{- block.settings.image | image_url: width: block.settings.image.width | image_tag: loading: loading_strategy, sizes: 'min(50vw, 575px)', widths: '600,700,800,1000,1200,1400,1600,1800', class: 'image-contain' -}}
               </picture>
             {%- else -%}
               {%- capture placeholder_image -%}lifestyle-{% cycle '1', '2' %}{%- endcapture -%}
               {{- placeholder_image | placeholder_svg_tag: 'placeholder placeholder--invert image-cover' -}}
             {%- endif -%}
         </div>
      {% endcapture %}
      <div {{ block.shopify_attributes }}>
        <div
          class="block-timeline-item"
          data-tab-labelled-by="{{ block.settings.label }}"
          style="{% unless forloop.first %}display:none;{% endunless %}"
        >
          {% if block.settings.image_allignment == 'left' %}
            {{ image_content }}
          {% endif %}
          <div class="block-content-container">
            <h3 class="block-heading">
              {{ block.settings.heading }}
            </h3>
            <div class="block-text">
              {{ block.settings.content }}
            </div>
            {% if block.settings.link_text != blank %}
              {%- render 'button',
                href: block.settings.link_url,
                content: block.settings.link_text,
                style: block.settings.link_style
              -%}
            {% endif %}
          </div>
          {% if block.settings.image_allignment == 'right' %}
            {{ image_content }}
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </timeline-block-items>
</div>
<style>
  .timeline-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  button.timeline-nav-button {
    color: #000000;
    font-family: var(--text-font-family);
    font-size: 32px;
    font-style: normal;
    font-weight: 100;
    line-height: normal;
    text-transform: uppercase;
    position: relative;
  }
  timeline-nav-items {
    display: flex;
    flex-wrap: wrap;
    gap: 25px;
    justify-content: flex-end;
  }
  .nav-highlight{
      flex-basis: 100%;
   }
  .nav-highlight .timeline-nav-button{
    font-size: 80px;
    font-weight: 300;
    flex-grow: 1;
    text-align: left;
    float: right;
  }
  .timeline-nav-button:after {
    content: '';
    width: calc(100% - var(--heading-letter-spacing));
    transform-origin: var(--transform-origin-start);
    background: #000;
    height: 3px;
    transition: transform 0.25s ease-in-out;
    position: absolute;
    inset-block-end: -0rem;
    inset-inline-start: 0;
    transform: scaleX(0);
  }
  .timeline-nav--selected:after {
    transform: scaleX(1);
  }
  h1.timeline-heading {
    font-family: var(--text-font-family);
    font-size: 187px;
    font-style: normal;
    font-weight: 900;
    line-height: normal;
    text-transform: uppercase;
    background: url('{{ section.settings.title_background | img_url: 'master' }}') lightgray -30.486px -132.217px /
      106.671% 235.472% no-repeat;
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-repeat: no-repeat;
    background-size: cover;
    background-position: center;
  }
</style>
<script>
  window.addEventListener('load', () => {
    class TimelineNavItems extends HTMLElement {
      constructor() {
        super();
        this.items = this.querySelectorAll('.timeline-nav-button');
        this.items.forEach((item) => {
          item.addEventListener('click', () => {
            this.items.forEach((item) => {
              item.classList.remove('timeline-nav--selected');
            });
            item.classList.add('timeline-nav--selected');
          });
        });
      }
    }
    class TimelineBlockItems extends HTMLElement {
      constructor() {
        super();
      }
    }

    class TimelineSection {
      constructor() {
        this.timelineNavItems = document.querySelector('timeline-nav-items');
        this.timelineBlockItems = document.querySelector('timeline-block-items');
      }

      connectObserver() {
        const observer = new MutationObserver((mutations) => {
          console.log('observer', mutations);
          mutations.forEach((mutation) => {
            if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
              const target = mutation.target;
              if (target.classList.contains('timeline-nav--selected')) {
                const targetLabel = target.getAttribute('data-tab-label');
                const targetBlockItem = this.timelineBlockItems.querySelector(
                  `[data-tab-labelled-by="${targetLabel}"]`
                );
                console.log(`[data-tab-lablled-by="${targetLabel}"]`, targetBlockItem);
                this.timelineBlockItems.querySelectorAll('.block-timeline-item').forEach((item) => {
                  item.style.display = 'none';
                });
                targetBlockItem.style.display = 'block';
              }
            }
          });
        });
        observer.observe(this.timelineNavItems, { attributes: true, childList: true, subtree: true });
      }
    }

    customElements.define('timeline-nav-items', TimelineNavItems);
    customElements.define('timeline-block-items', TimelineBlockItems);

    const timelineNavItems = document.querySelector('timeline-nav-items');
    const timelineBlockItems = document.querySelector('timeline-block-items');
    if (timelineNavItems) {
      new TimelineNavItems();
    }
    if (timelineBlockItems) {
      new TimelineBlockItems();
    }

    const timelineSection = new TimelineSection();
    timelineSection.connectObserver();
  });
</script>

{% schema %}
{
  "name": "Timeline Section",
  "tag": "section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "About Us"
    },
    {
      "type": "image_picker",
      "id": "title_background",
      "label": "Title Bacdrop Image"
    }
  ],
  "blocks": [
    {
      "type": "timeline_item",
      "name": "Timeline Item",
      "settings": [
        {
          "type": "select",
          "id": "image_allignment",
          "label": "Image Allignment",
          "options": [
            {
              "value": "left",
              "label": "left"
            },
            {
              "value": "right",
              "label": "right"
            }
          ],
          "default": "right"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "label",
          "label": "Navigation Label",
          "default": "2020"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Title"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Content"
        },
        {
          "type": "text",
          "id": "link_text",
          "label": "Button Text",
          "default": "Learn More"
        },
        {
          "type": "url",
          "id": "link_url",
          "label": "Button Link"
        },
        {
          "type": "select",
          "id": "link_style",
          "label": "t:global.text.link_style",
          "options": [
            {
              "value": "outline",
              "label": "t:global.text.link_style_options.outline"
            },
            {
              "value": "solid",
              "label": "t:global.text.link_style_options.solid"
            },
            {
              "value": "link",
              "label": "t:global.text.link_style_options.link"
            }
          ],
          "default": "link"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Timeline Section"
    }
  ]
}
{% endschema %}
